# malloc.cのdocument

## 実装したもの
- best-fit
- free list bin
- right merge

### best-fitに関して
1. linked listで実装されている全てのfreelistを探索する
2. 暫定最適freelistのアドレスを格納する変数を用意しておく
3. 今必要なデータ数よりも大きく、暫定freelistよりも小さいサイズのものが存在していたらそれに更新するということを繰り返す

### free list binに関して
1. linkedlistをいくつ作るのかということを決定する
2. どのサイズをどのlinkedlistに格納するのかということをget_index()関数で実装
3. my_initialize()関数、my_malloc()関数などを複数のlinkedlistに対応するように変更する(その際、get_index関数を用いてindex取得)

#### 工夫した点
メンターさんに教えていただいた内容になってしまうが、メモリのサイズを標準出力して目で確認したところ、4096に近い数よりも8に近い数のほうが多く使われているということを確認することができた。そこでget_index関数をメモリサイズのlog2を取ることでlinkedlistのindexに傾斜をつけることができる。

### right mergeに関して
1. メモリを解放するときに一つ右隣のアドレスを取得
2. そのアドレスがfreelistに含まれているかを探索
3. 含まれていたら、現在解放しようとしているメモリと結合する(memory sizeを更新することで実装)
4. 右隣のアドレス(aとする)がfreelistに含まれていた時には、freelistのlinkedlistでもともとaの一つ前に存在していたfreememoryのnextポインタを今回解放しようとしているアドレスに更新する
5. 右隣のアドレスがfreelistに含まれていなければ、今回解放しようとしていたメモリのみ解放する

#### 工夫した点
右隣のメモリを参照するときに、そのメモリが今回私が触っていいメモリなのかということの確認をしないと、全く関係のないファイルが保持しているメモリを書き換えてしまう可能性が出てくる。そこで今回触っていいメモリの規則である、アドレスが4096の倍数であるということを用いて、右隣のアドレスが4096の倍数であればright-mergeを実行するが、そうでなければ実行しないようフラグを用意した。

